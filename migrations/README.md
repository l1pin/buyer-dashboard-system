# Миграция: Привязка байеров к офферам

## Описание
Эта миграция добавляет функционал привязки Media Buyers к офферам по источникам трафика (Facebook, Google, TikTok).

## Что добавляется
- Таблица `offer_buyers` для хранения связей между офферами и байерами
- Индексы для быстрого поиска
- Ограничения для валидации данных

## Как выполнить миграцию

### Вариант 1: Через Supabase Dashboard (рекомендуется)

1. Откройте https://supabase.com/dashboard
2. Выберите ваш проект
3. Перейдите в **SQL Editor**
4. Создайте новый запрос
5. Скопируйте и вставьте содержимое файла `add_offer_buyers.sql`
6. Нажмите **Run** или **Ctrl+Enter**

### Вариант 2: Через psql (если есть прямой доступ к БД)

```bash
psql "ваша_строка_подключения" < migrations/add_offer_buyers.sql
```

## Проверка выполнения миграции

После выполнения миграции проверьте что таблица создана:

```sql
SELECT * FROM offer_buyers LIMIT 1;
```

## Откат миграции

Если нужно откатить миграцию:

```sql
DROP TABLE IF EXISTS offer_buyers CASCADE;
```

## Структура таблицы

| Поле | Тип | Описание |
|------|-----|----------|
| id | BIGSERIAL | Первичный ключ |
| offer_id | INTEGER | ID оффера из metrics_analytics |
| buyer_id | UUID | ID байера из таблицы users |
| source | TEXT | Источник трафика (Facebook/Google/TikTok) |
| created_at | TIMESTAMP | Дата создания привязки |

## Использование

После выполнения миграции функционал будет доступен во вкладке **Офферы**:
- Под каждым оффером появится плашка с 3 колонками (Facebook, Google, TikTok)
- Кнопка "+" позволяет привязать байера к источнику
- Привязанные байеры отображаются в виде карточек с аватаркой
- Наведение на карточку байера показывает кнопку удаления
