# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞–º–∏ –æ—Ñ—Ñ–µ—Ä–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å–∞–º–∏ –æ—Ñ—Ñ–µ—Ä–æ–≤ —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ö–∞–∂–¥—ã–π –æ—Ñ—Ñ–µ—Ä –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–¥–∏–Ω –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ü–≤–µ—Ç–∞–º–∏:

- **–ê–∫—Ç–∏–≤–Ω—ã–π** (üü¢ –ó–µ–ª–µ–Ω—ã–π)
- **–ü–∞—É–∑–∞** (üü° –ñ–µ–ª—Ç—ã–π)
- **–ó–∞–∫–æ–Ω—á–∏–ª—Å—è** (üî¥ –ö—Ä–∞—Å–Ω—ã–π)
- **–û—Ç–ª–µ–∂–∫–∞** (üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π)
- **–ü–µ—Ä–µ–¥–µ–ª** (üîµ –ì–æ–ª—É–±–æ–π)
- **–ö–¶** (üü¢üîµ –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π)

## –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL-—Ñ–∞–π–ª `migration_offer_statuses.sql` –≤ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL:

```bash
# –ß–µ—Ä–µ–∑ psql
psql -h [HOST] -U [USER] -d [DATABASE] -f migration_offer_statuses.sql

# –ò–ª–∏ —á–µ—Ä–µ–∑ Supabase Dashboard
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
# 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor
# 3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ migration_offer_statuses.sql
# 4. –ù–∞–∂–º–∏—Ç–µ Run
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã:

- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `offer_statuses`
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ RLS (Row Level Security) –≤ Supabase

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ RLS –≤ Supabase, –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞:

```sql
-- –†–∞–∑—Ä–µ—à–∏—Ç—å —á—Ç–µ–Ω–∏–µ –≤—Å–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
CREATE POLICY "Allow read for authenticated users"
ON offer_statuses FOR SELECT
TO authenticated
USING (true);

-- –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å—Ç–∞–≤–∫—É –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
CREATE POLICY "Allow insert for authenticated users"
ON offer_statuses FOR INSERT
TO authenticated
WITH CHECK (true);

CREATE POLICY "Allow update for authenticated users"
ON offer_statuses FOR UPDATE
TO authenticated
USING (true)
WITH CHECK (true);
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

1. **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞**: –í —Ç–∞–±–ª–∏—Ü–µ –æ—Ñ—Ñ–µ—Ä–æ–≤ –∫–∞–∂–¥—ã–π –æ—Ñ—Ñ–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å —Ü–≤–µ—Ç–Ω—ã–º –∫—Ä—É–∂–∫–æ–º –∏ —Ç–µ–∫—Å—Ç–æ–º —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞

2. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞**: –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫—Ä—É–∂–æ–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º, –æ—Ç–∫—Ä–æ–µ—Ç—Å—è dropdown –º–µ–Ω—é —Å–æ –≤—Å–µ–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏

3. **–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤**: –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É "i" —Ä—è–¥–æ–º —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ß–µ—Ä–µ–∑ API

```javascript
import { offerStatusService } from './supabaseClient';

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ñ—Ñ–µ—Ä–∞
const status = await offerStatusService.getOfferStatus(offerId);

// –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
await offerStatusService.upsertOfferStatus(
  offerId,
  '–ü–∞—É–∑–∞',
  '–ê—Ä—Ç–∏–∫—É–ª123',
  '–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ñ—Ñ–µ—Ä–∞',
  '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è',
  '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)'
);

// –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
const history = await offerStatusService.getOfferStatusHistory(offerId);
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ offer_statuses

```sql
CREATE TABLE offer_statuses (
  id SERIAL PRIMARY KEY,
  offer_id INTEGER NOT NULL,
  article VARCHAR(255),
  offer_name TEXT,
  current_status VARCHAR(50) NOT NULL DEFAULT '–ê–∫—Ç–∏–≤–Ω—ã–π',
  status_history JSONB NOT NULL DEFAULT '[]'::jsonb,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### –§–æ—Ä–º–∞—Ç –∏—Å—Ç–æ—Ä–∏–∏ (JSONB)

```json
[
  {
    "status": "–ê–∫—Ç–∏–≤–Ω—ã–π",
    "changed_at": "2025-11-20T12:00:00.000Z",
    "changed_by": "user@example.com",
    "comment": "–û—Ñ—Ñ–µ—Ä –∑–∞–ø—É—â–µ–Ω"
  },
  {
    "status": "–ü–∞—É–∑–∞",
    "changed_at": "2025-11-15T10:30:00.000Z",
    "changed_by": "admin@example.com",
    "comment": "–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞"
  }
]
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **OfferStatusBadge** - –ö–Ω–æ–ø–∫–∞-badge —Å —Ü–≤–µ—Ç–Ω—ã–º –∫—Ä—É–∂–∫–æ–º –∏ dropdown –º–µ–Ω—é
- **OfferStatusHistoryModal** - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π —Å—Ç–∞—Ç—É—Å–æ–≤
- **offerStatusService** - API —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ç–∞–±–ª–∏—Ü—ã metrics_analytics (–Ω–µ—Ç foreign key)
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –¥–∞—Ç–∞–º–∏ –∏ –∞–≤—Ç–æ—Ä–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
- ‚úÖ –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º
- ‚úÖ JSONB –¥–ª—è –≥–∏–±–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
2. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ª–∏ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase
3. –î–æ—Å—Ç—É–ø–Ω—ã –ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ
4. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ª–∏ offerStatusService –≤ –Ω—É–∂–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
